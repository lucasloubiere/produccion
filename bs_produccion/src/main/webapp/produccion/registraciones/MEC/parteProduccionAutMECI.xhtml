<ui:composition 
xmlns="http://www.w3.org/1999/xhtml"
xmlns:h="http://java.sun.com/jsf/html"
xmlns:f="http://java.sun.com/jsf/core"
xmlns:ui="http://java.sun.com/jsf/facelets"
xmlns:p="http://primefaces.org/ui" >
    
    <h:panelGroup rendered="#{not parteProduccionAutomaticoBeanMEC.m.persistido}" style="width: 100%;">

        <p:tabView style="min-height: 200px;">

            <p:tab title="Items">

                <p:dataTable id="detalle" value="#{parteProduccionAutomaticoBeanMEC.m.itemProducto}"
                             var="p" scrollable="true" scrollHeight="200"
                             emptyMessage="#{msgs.pcc_msgNoEncontraronProductos}"
                             rowStyleClass="#{p.conError ? 'conError' : null}" >

                    <p:column headerText="#{msgs.pcc_codigo}" width="120">
                        <h:outputText value="#{p.producto.artcod}" rendered="#{not empty p.producto}"/>                        
                    </p:column>

                    <p:column headerText="#{msgs.pcc_descripcion}" width="380" >
                        <h:outputText value="#{p.producto.descrp}"  rendered="#{not empty p.producto}"/>                        
                    </p:column>

                    <p:column headerText="#{msgs.pcc_cantidad}" width="60">
                        <p:inputText value="#{p.cantid}" size="8" id="cantidad" style="text-align: right;"  >
                            <f:convertNumber pattern="0" />
                            <p:ajax listener="#{parteProduccionAutomaticoBeanMEC.actualizarCantidades(p)}"
                                    update="@form"/>
                        </p:inputText>

                    </p:column>

                    <p:column headerText="#{msgs.pcc_UM}" width="25" style="text-align: center;" >
                        <h:outputText value="#{p.producto.unidadMedida.unidad}" rendered="#{not empty p.producto}" />                        
                    </p:column>

                    <p:column headerText="Serie/Lote" width="70">
                        <p:inputText value="#{p.nserie}" size="10" style="text-align: right;" >
                            <p:ajax listener="#{parteProduccionAutomaticoBeanMEC.actualizarAtributos(p)}"  />
                        </p:inputText>
                    </p:column>

                    <p:column headerText="Serie desde" width="70">
                        <p:inputText value="#{p.serdes}" size="10" />

                    </p:column>

                    <p:column headerText="Serie hasta" width="70">
                        <p:inputText value="#{p.serhas}" size="10" />
                    </p:column>

                    <p:column headerText="Aplicación" width="75">
                        <h:outputText value="#{p.codori}" />
                        -
                        <h:outputText value="#{p.nroori}" >
                            <f:convertNumber pattern="00000000" />
                        </h:outputText>

                    </p:column>

                    <p:column headerText="#{msgs.accion}" width="60" style="text-align: center;">
                        <p:commandButton rendered="#{empty p.producto}"
                                         actionListener="#{parteProduccionAutomaticoBeanMEC.agregarItem(p)}" icon="add16"
                                         update="detalle"  />

                        <p:commandButton immediate="true" rendered="#{not empty p.producto}"
                                         actionListener="#{parteProduccionAutomaticoBeanMEC.eliminarItemProducto(p)}" icon="delete16"
                                         process="@this"
                                         update="detalle"  />
                    </p:column>

                </p:dataTable>

            </p:tab>

            <p:tab title="Vale de Consumo" rendered="#{not empty parteProduccionAutomaticoBeanMEC.m.valeConsumo}">

                <h:panelGrid columns="4" cellspacing="2" columnClasses="colLabel,colDato,colLabel,colDato" width="700" >

                    <h:outputLabel value="Deposito egreso:" for="depegr" />
                    <h:outputLabel id="depegr" value="#{parteProduccionAutomaticoBeanMEC.m.valeConsumo.depositoTransferencia.deposi} - #{parteProduccionAutomaticoBeanMEC.m.valeConsumo.depositoTransferencia.descrp}" />

                    <h:outputText value="#{msgs.pcc_observaciones}: " />
                    <p:inputTextarea value="#{parteProduccionAutomaticoBeanMEC.m.valeConsumo.textos}" rows="2" cols="70" />

                </h:panelGrid>

                <p:dataTable id="detallevc" value="#{parteProduccionAutomaticoBeanMEC.m.valeConsumo.itemProducto}"
                             var="p" scrollable="true" scrollHeight="200"
                             emptyMessage="#{msgs.pcc_msgNoEncontraronProductos}"
                             rowStyleClass="#{p.conError ? 'conError' : null}" >

                    <p:column headerText="#{msgs.pcc_codigo}" width="120">
                        <h:outputText value="#{p.producto.artcod}" rendered="#{not empty p.producto}"/>                        
                    </p:column>

                    <p:column headerText="#{msgs.pcc_descripcion}" width="380" >
                        <h:outputText value="#{p.producto.descrp}"  rendered="#{not empty p.producto}"/>
                        
                    </p:column>

                    <p:column headerText="#{msgs.pcc_cantidad}" width="60">
                        <p:inputText value="#{p.cantid}" size="8" id="cantidad" style="text-align: right;" >
                            <f:convertNumber pattern="0.00" />
                            <p:ajax listener="#{parteProduccionAutomaticoBeanMEC.actualizarCantidades(p)}"
                                    update="cantidad,apertura"/>
                        </p:inputText>
                    </p:column>

                    <p:column headerText="#{msgs.pcc_UM}" width="25" style="text-align: center;" >
                        <h:outputText value="#{p.producto.unidadMedida.unidad}" rendered="#{not empty p.producto}" />                        
                    </p:column>

                    <p:column headerText="Serie/Lote" width="70">
                        <p:inputText value="#{p.nserie}" size="10" style="text-align: right;" >
                            <p:ajax listener="#{parteProduccionAutomaticoBeanMEC.actualizarAtributos(p)}"
                                update="apertura"/>
                        </p:inputText>
                    </p:column>

                    <p:column headerText="Ver stock" width="60" style="text-align: center;">
                        <p:commandButton icon="find16"
                                         actionListener="#{sT_ConsultaStockByProductoDeposito.verStockByProductoDeposito(p.producto,parteProduccionAutomaticoBeanMEC.m.valeConsumo.sectorTransferencia)}"
                                         update=":formulario:consultaStockByProductoDeposito"
                                         oncomplete="dlg_stockByProductoDeposito.show()"  />
                    </p:column>

                    <p:column headerText="Apertura" width="40" style="text-align: center;">
                        <p:rowToggler />
                    </p:column>

                    <p:rowExpansion>

                        <p:dataTable id="apertura" value="#{p.itemDetalle}" var="d"
                                     style="margin: 5px; float: right;" >

                            <p:column headerText="#{msgs.pcc_cantidad}" width="60" >
                                <p:inputText value="#{d.cantid}" size="8" id="cantidad" style="text-align: right;" >
                                    <f:convertNumber pattern="0.00" />
                                </p:inputText>
                            </p:column>

                            <p:column headerText="#{msgs.pcc_UM}" width="25" style="text-align: center;">
                                <h:outputText value="#{d.unimed}"/>
                            </p:column>

                            <p:column headerText="Serie/Lote" width="70">
                                <p:inputText value="#{d.nserie}" size="10" style="text-align: right;"/>
                            </p:column>
                            
                            <p:column headerText="#{msgs.accion}" width="60" style="text-align: center;">

                                <p:commandButton immediate="true" icon="delete16" rendered="#{not empty d.producto}"
                                                 actionListener="#{parteProduccionAutomaticoBeanMEC.eliminarItemDetalle(p,d)}"
                                                 process="@this"
                                                 update="apertura"  />
                            </p:column>

                           <f:facet name="footer">
                                <p:commandButton value="Agregar item"  icon="add16"
                                                 style="margin: 5px;"
                                                 actionListener="#{parteProduccionAutomaticoBeanMEC.agregarItemDetalle(p)}"
                                                 update="@parent"  />
                            </f:facet>

                        </p:dataTable>

                    </p:rowExpansion>

                    <p:column headerText="Aplicación" width="75">
                        <h:outputText value="#{p.codori}" />
                        -
                        <h:outputText value="#{p.nroori}" >
                            <f:convertNumber pattern="00000000" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="#{msgs.accion}" width="60" style="text-align: center;">
                        <p:commandButton rendered="#{empty p.producto}"
                                         actionListener="#{parteProduccionAutomaticoBeanMEC.agregarItem(p)}" icon="add16"
                                         update="@form"  />

                        <p:commandButton immediate="true" rendered="#{not empty p.producto}"
                                         actionListener="#{parteProduccionAutomaticoBeanMEC.eliminarItemProducto(p.movimiento,p)}" icon="delete16"
                                         process="@this"
                                         update="detallevc"  />
                    </p:column>

                </p:dataTable>

            </p:tab>

            <p:tab title="Parte Proceso" rendered="#{not empty parteProduccionAutomaticoBeanMEC.m.parteProceso}">

                <p:dataTable id="detallepp" value="#{parteProduccionAutomaticoBeanMEC.m.parteProceso.itemProducto}"
                             var="p" scrollable="true" scrollHeight="200"
                             emptyMessage="#{msgs.pcc_msgNoEncontraronProductos}"
                             rowStyleClass="#{p.conError ? 'conError' : null}" >

                    <p:column headerText="#{msgs.pcc_codigo}" width="120">
                        <h:outputText value="#{p.producto.artcod}" rendered="#{not empty p.producto}"/>                        
                    </p:column>

                    <p:column headerText="#{msgs.pcc_descripcion}" width="380" >
                        <h:outputText value="#{p.producto.descrp}"  rendered="#{not empty p.producto}"/>                        
                    </p:column>

                    <p:column headerText="Operario" width="200">
                            <p:selectOneMenu value="#{p.operario}" style="width: 200px;"
                                             effect="fade" converter="#{conversoresProduccion.operario}"
                                             filter="true" filterMatchMode="contains">

                                <f:selectItem itemLabel="Seleccionar" itemValue="" />
                                <f:selectItems value="#{buscadorOperarioBean.lista}"
                                               var="i" itemLabel="#{i.nombre}" itemValue="#{i}"/>
                                <p:ajax process="@this" update="@parent"/>
                            </p:selectOneMenu>
                        </p:column>


                    <p:column headerText="#{msgs.pcc_cantidad}" width="60" >
                        <p:inputText value="#{p.cantid}" size="8" id="cantidad" style="text-align: right;" >
                            <f:convertNumber pattern="0.00" />
                        </p:inputText>
                    </p:column>

                    <p:column headerText="#{msgs.pcc_UM}" width="25" style="text-align: center;" >
                        <h:outputText value="#{p.producto.unidadMedida.unidad}" rendered="#{not empty p.producto}" />                        
                    </p:column>

                    <p:column headerText="Aplicación" width="75">
                        <h:outputText value="#{p.codori}" />
                        -
                        <h:outputText value="#{p.nroori}" >
                            <f:convertNumber pattern="00000000" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="#{msgs.accion}" width="60" style="text-align: center;">
                        <p:commandButton rendered="#{empty p.producto}"
                                         actionListener="#{parteProduccionAutomaticoBeanMEC.agregarItem(p)}" icon="add16"
                                         update="@form"  />

                        <p:commandButton immediate="true" rendered="#{not empty p.producto}"
                                         actionListener="#{parteProduccionAutomaticoBeanMEC.eliminarItemProducto(p.movimiento,p)}" icon="delete16"
                                         process="@this"
                                         update="detallepp"  />
                    </p:column>

                </p:dataTable>

            </p:tab>
            
        </p:tabView>

    </h:panelGroup>

</ui:composition>